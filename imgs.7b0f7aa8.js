class e{constructor(e){this.buffer=e,this.pointer=0}readNumber(e,t=!0){return this.bytesToNumber(this.readBytes(e,t))}readFloat(e=!0){const t=new ArrayBuffer(4),r=new DataView(t),a=this.readBytes(4,e);for(const e in a)r.setUint8(e,a[e]);return r.getFloat32(0,!0)}readString(e,t=!0){return this.bytesToString(this.readBytes(e,t))}readBytes(e,t=!0){const r=new Uint8Array(this.buffer.slice(this.pointer,this.pointer+e));return t&&(this.pointer+=e),r}bytesToNumber(e){let t=0;for(let r=0;r<e.length;r++)t+=e[r]<<8*r;return t}bytesToString(e){let t="";for(let r=0;r<e.length;r++)t+=String.fromCharCode(e[r]);return t}}class t{constructor(e){const t=e.readNumber(4)/4;this.colors=[];for(let r=0;r<t;r++)this.colors[r]={},this.colors[r].b=e.readNumber(1),this.colors[r].g=e.readNumber(1),this.colors[r].r=e.readNumber(1),this.colors[r].a=e.readNumber(1)}}class r{constructor(e){this.dataLength=e.readNumber(4),this.tableSize=e.readNumber(1),this.width=e.readNumber(2),this.height=e.readNumber(2),this.mp1=e.readNumber(2),this.mp2=e.readNumber(2),this.imageSize=e.readNumber(4),this.imageType=e.readNumber(1),this.data=[],this.imageData=new ImageData(this.width,this.height),this.zBuffer=[],5===this.imageType?this.readAlphaChannelImage(e):this.readImage(e)}readImage(e){const t=Math.ceil(-(this.height*this.width-this.imageSize)/this.height),r=e.readBytes(this.imageSize);let a=0;for(let e=this.height-1;e>=0;e--){for(let t=0;t<this.width;t++,a++){const s=t+e*this.width;this.data[s]=r[a]}a+=t}}readAlphaChannelImage(e){const t=0==this.tableSize?600:1==this.tableSize?752:960;let r=0;for(;65535!==e.readNumber(2,!1);){r+=e.readNumber(2);const a=e.readNumber(2);for(let s=0;s<a;s++){const a=e.readNumber(2),s=e.readNumber(1),i=r%t+(this.height-1-Math.floor(r/t))*this.width;this.data[i]=s,this.zBuffer[i]=a,r++}}e.readNumber(2)}makeImageData(e){for(const t in this.data){const r=this.data[t],a=void 0!==r,s=4*t,i=a?e.colors[r]:{r:0,g:0,b:0};this.imageData.data[s+0]=i.r,this.imageData.data[s+1]=i.g,this.imageData.data[s+2]=i.b,this.imageData.data[s+3]=a?255:0}}}class a{constructor(e){const t=e.readNumber(4);this.text=e.readString(t),this.text=this.text.substring(0,t-1)}}class s{constructor(e){this.dataLength=e.readNumber(4),this.tableSize=e.readNumber(1),this.width=e.readNumber(2),this.height=e.readNumber(2),this.fullWidth=e.readNumber(2),this.unk3=e.readNumber(4),this.unk4=e.readNumber(2),this.unk5=e.readNumber(2),this.zBuffer=[];const t=[];for(let r=0;r<this.fullWidth*this.height;r++){const a=e.readNumber(2);r%this.fullWidth>=this.width||t.push(a)}for(const e in t){const r=e%this.width,a=(this.height-1-Math.floor(e/this.width))*this.width+r;this.zBuffer.push(t[a])}}}class i{constructor(e){this.value=e.readNumber(2)}}class h{constructor(e){const t=e.readNumber(4);this.data=e.readBytes(t)}}class n{constructor(e){this.dataLength=e.readNumber(4),this.table=[];const t=this.dataLength/4;for(let r=0;r<t;r++)this.table.push(e.readFloat())}}class o{constructor(e){this.dataLength=e.readNumber(4);const t=this.dataLength/2;this.table=[];for(let r=0;r<t;r++)this.table.push(e.readNumber(2))}}class d{constructor(d){this.dataURI="",this.header={signature:"PARTOUT(4.0)RESOURCE",appName:"",description:"",fileSize:0,nGroups:0,tableSize:0,fullWidth:0};const u=new e(d);let c;this.groups=[],u.pointer=21,this.header.appName=u.readString(50),this.header.description=u.readString(100),this.header.fileSize=u.readNumber(4),this.header.nGroups=u.readNumber(2),this.header.tableSize=u.readNumber(2),this.header.fullWidth=u.readNumber(4);const l=[];for(let e=0;e<this.header.nGroups;e++){const d=[],m=u.readNumber(1);for(let g=0;g<m;g++){let m;switch(u.readNumber(1)){case 0:m=new i(u);break;case 1:m=new r(u),l.push({group:e,entry:g});break;case 5:m=new t(u),c=m;break;case 3:case 9:m=new a(u);break;case 10:m=new o(u);break;case 11:m=new n(u);break;case 12:m=new s(u);break;default:m=new h(u)}d.push(m)}this.groups.push(d)}for(const e of l){this.groups[e.group][e.entry].makeImageData(c)}}}function u(e){var t=document.createElement("div"),i=[];e.groups.forEach((function(e,t){e.forEach((function(a,h){(a instanceof r||a instanceof s)&&i.push({entry:a,entryID:h,group:e,groupID:t})}))}));let h="",n="",o=1;return i.filter((e=>2===e.entry.tableSize)).forEach((function(e){let s;if(e.entry instanceof r){i=e.entry,d=document.createElement("canvas"),u=d.getContext("2d"),d.width=i.width,d.height=i.height,u.putImageData(i.imageData,0,0),s=d;const t=e.group.filter((e=>e instanceof a));if(t.length>0){const e=`{ name: "${t[0].text}", `;h+=e,n=t[0].text,o=1}else h+=`{ name: "${n}_${o}", `,o++;h+=`group: ${e.groupID}, entry: ${e.entryID} }\n`}else s=function(e){var t=document.createElement("canvas"),r=t.getContext("2d"),a=e.width,s=e.height;t.width=a,t.height=s;var i=r.getImageData(0,0,a,s),h=i.data;for(let t=0;t<e.width*e.height;t++){var n=4*t,o=e.zBuffer[t]/65535*255;h[n+0]=o,h[n+1]=o,h[n+2]=o,h[n+3]=255}return r.putImageData(i,0,0),t}(e.entry);var i,d,u;s.title=`${e.groupID}-${e.entryID}`,t.appendChild(s)})),console.log(h),t}var c=document.getElementById("file"),l=document.getElementById("images");c.onchange=function(){var e=c.files[0],t=new FileReader;t.onload=function(){var e=new d(t.result);l.innerHTML="",l.appendChild(u(e))},t.readAsArrayBuffer(e)};
//# sourceMappingURL=imgs.7b0f7aa8.js.map
